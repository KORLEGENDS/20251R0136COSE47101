	방법론
패널을 구축해 정상화된 테이블을 얻은 뒤, 핵심 분석은 세 개의 축—헤도닉 가격 회귀(OLS + HC3), τ-스케일 "런치 트랙터리" 곡선, 그리고 이벤트 스터디—로 전개되었다. 방법론 전체는 07_train_models.py와 08_event_study.py 두 스크립트에 집약돼 있으며, 두 단계 모두 다층 패널 설계를 전제로 한다.

## 1. K-means 기반 지역 특성 clustering
클러스터링 기반 지역 특성 분석에서 분석의 첫 번째 단계로, 전국 17개 시도의 주택시장 특성을 체계적으로 파악하기 위해 K-means 클러스터링을 수행했다. 이는 단순한 행정구역 구분을 넘어서 경제적·사회적 유사성을 기반으로 한 시장 세분화를 목표로 했다. 클러스터링 방법론에서는 특별공급 경쟁률, 일반공급 경쟁률, 지역 GDP를 핵심 지표로 선정하고, StandardScaler를 사용한 정규화로 변수 간 스케일 차이를 해결했다. Elbow Method와 Silhouette Analysis를 통해 k=3을 결정하고, K-means 알고리즘을 적용하여 random_state=42로 재현성을 확보했다. 품질 평가에서는 Silhouette Score 0.713으로 높은 품질을 확인했다.

클러스터링 결과의 해석에서 클러스터 0은 14개 지역의 일반적 지역시장으로 낮은 경쟁률과 중간 GDP를 보이며, 클러스터 1은 서울·세종의 초과수요 시장으로 극높은 경쟁률과 높은 GDP를 나타낸다. 클러스터 2는 경기도의 독특한 시장구조로 중간 경쟁률과 최고 GDP를 기록한다. 이러한 클러스터링 결과는 후속 헤도닉 분석에서 지역 더미 변수로 활용되어 모델의 설명력을 향상시켰다.

클러스터링 탐색 분석에서 EDA 단계에서 K-means(k = 3)와 계층적 군집(Ward)를 병행해 '특별공급 경쟁률·일반공급 경쟁률·지역 GDP' 3개 핵심 변수를 군집화하였다. Elbow Method, Silhouette Score(0.713), Calinski-Harabasz Index가 일관되게 k=3을 지지했다. 클러스터링 결과 상세 분석에서 클러스터 C0은 특별공급 경쟁률 1.42, 일반공급 경쟁률 14.52, GDP 평균 852억원으로 강원, 경남, 경북, 광주, 대구, 대전, 부산, 울산, 인천, 전남, 전북, 제주, 충남, 충북을 포함하는 일반적 지역시장을 나타낸다. 클러스터 C1은 특별공급 경쟁률 59.12, 일반공급 경쟁률 203.12, GDP 평균 2,720억원으로 서울, 세종을 포함하는 초과수요 시장을 형성한다. 클러스터 C2는 특별공급 경쟁률 5.11, 일반공급 경쟁률 20.6, GDP 평균 5,814억원으로 경기도만을 포함하는 독립적 시장구조를 보인다.

클러스터링 품질 지표로는 Silhouette Score 0.713으로 매우 양호한 결과를 보였고(기준 ≥ 0.25), Calinski-Harabasz Index는 높은 클러스터 간 분리도를, Davies-Bouldin Index는 낮은 클러스터 내 분산을 나타냈다. 군집 결과는 더미(cluster_label ∈ {0,1,2})로 변환되어 기존 𝑿 행렬에 컬럼 3개가 추가되었고, Hedonic OLS 재적합 시 R² +0.008, MAPE –0.22 %p의 개선을 확인하였다. 구현 코드는 analysis/clustering_analysis.py에 포함되며, 결과는 analysis/result/ 디렉토리에 체계적으로 저장되어 재현성을 확보했다.

클러스터링의 정책적 함의로는 서울-세종 동질성에서 행정수도 이전과 수도권 집중이 유사한 시장압력을 생성하고, 경기도 독특성에서 높은 경제력에도 불구하고 상대적으로 낮은 경쟁률을 보여 공급 확대 정책의 효과적 대상임을 시사한다. 지역시장 세분화에서는 14개 지역의 유사한 시장 특성으로 표준화된 정책 적용이 가능함을 보여준다.

## 2. Hedonic Model & DiD Event Study
먼저 헤도닉 OLS는 단지 × 월 패널을 대상으로 로그·Box-Cox·Yeo-Johnson 변환을 마친 가격 변수 yj_ln_price를 종속변수로 삼았다. 설명변수 매트릭스 𝑿에는 구조·입지·거시·교통·수급 차원의 240여 개 지표가 포함된다. 고정효과는 두 겹이다. 단지 고유 특질(준공연도·용적률·학군 등)과 불변 입지효과를 흡수하기 위해 complex_id를 범주형으로 투입했고, 거시 상황·계절성을 제어하려고 year_month 더미도 추가했다. 이중 고정효과 디자인은 구조적으로 다층 패널(도시 × 연도/분기)을 염두에 둔 기획안과 결을 같이 한다. 추정은 statsmodels.OLS(y, X).fit(cov_type='HC3') 규격으로 이뤄졌다. HC3는 관측치별 잔차 (1 – ℎᵢᵢ)²로 나눠 분산을 보정하기 때문에, 거래 빈도가 큰 단지와 희소 단지 간 이분산을 효과적으로 줄여 준다. 5-fold 교차검증을 병행해 과적합 여부를 점검했고, 폴드마다 R²≈0.78·MAPE≈6.9 %로 안정적인 성능이 확인됐다. 잔차는 패널 사후진단에서 드러난 잔차 자기상관(ρ≈0.12)을 반영해 Newey-West (4 lag)로 재추정했으나 계수 기호와 유의수준이 변하지 않아 기본 HC3 결과를 본문에 인용하기로 했다.

헤도닉 추정의 계수는 출발점이자, 향후 τ-스케일 곡선과 이벤트 스터디의 입력 재료다. 여기서 τ는 분양공고(또는 입주예정 공시) 시점을 0으로 놓고, –60 ≤ τ ≤ +60 개월 범위를 등 간격 월 단위로 재지정한 상대적 시계열이다. 08_event_study.py는 모든 단지의 yj_ln_price를 τ-타임라인에 맞춰 재샘플링하고, 각 τ에 대해 가격 수준을 분양 시점 가격으로 정규화한 뒤 LOWESS (프랙션 = 0.15)로 부드럽게 연결해 "런치 트랙터리"를 그린다. 이 곡선은 전통적 이벤트 스터디의 '리드·라그 계수'가 파란 점으로 흩뿌려진 모습을 하나의 연속적 트렌드로 시각화해, 입주 직후 조정(-3 % ~ -7 %)과 이후 30 개월부터 재상승(+5 % 이상) 같은 비선형 궤적을 직관적으로 보여 준다. 곡선 하단에는 90 % 부트스트랩 신뢰대(1 000 rep.)를 덧대 변동성을 표시했다.

이벤트 스터디 설계는 두 갈래다. 첫째, 교통·공급·정책 쇼크 변수(예: GTX-A 착공, LTV 한도 변경, 대규모 입주물량)별로 사건 더미를 두고, 앞서 얻은 τ-기반 잔차를 종속변수로 넣어 다중 DID(lead/lag) 회귀를 돌렸다. 둘째, 군집별(남부-강남축 vs 북서축) 이분법을 적용해 지역 고정효과가 결과에 미치는 차이를 살폈다. 사건 k의 시차 ℓ 효과는 계수 β로 표기하고 95 % 신뢰구간을 플랏했는데, GTX-A 착공 +12 개월(β= 0.031, p<0.01), 입주 대규모 물량 M-6 개월(β= -0.024, p<0.05) 등이 통계적으로 뚜렷했다. 이러한 "이벤트–조건부" 접근은 변수 후보군을 계층별로 정리한 사전 기획표의 취지와도 일치한다.

향후 확장 계획도 명확하다. 헤도닉 OLS를 베이스라인 삼아, 그래디언트 부스팅(GBM)·XGBoost·LSTM 같은 비선형·순환 모델을 동일 입력(679 feature)으로 돌려 성능과 해석 가능성의 트레이드오프를 비교할 예정이다. 또한 정책 충격의 인과 추정을 강화하기 위해 목적지별 통근시간 변동을 중재변수로 넣은 다층 DID(도시×연도/분기) 프레임을 구축하고, 선택 편의를 통제하려고 "거래량 가중 이중차이"(W-DiD) 기법을 적용할 계획이다. 이런 확장은 이미 파일 수준 메모에서 제안된 "다층 패널 + 이벤트 연구 + ML" 로드맵과 직결된다.

요약하면, HC3-보정 헤도닉 OLS로 계수의 해석력과 예측력을 확보하고, τ-스케일 곡선으로 분양-입주 전후의 비모수 궤적을 시각화하며, DID 이벤트 스터디로 교통·정책 쇼크의 동학을 계량함으로써 세 분석 축이 상호 보완적으로 작동한다. 그 결과는 3기 신도시 분양가 밴드 시뮬레이션, 정책 충격의 크기·지속 기간 추정, 그리고 향후 ML 모델 비교 실험의 공통 입력 포맷 제공이라는 세 가지 실질적 지점에서 응용될 예정이다.

## 3. ML모델 & 다층 DiD
향후 확장 단계는 예측 정확도 향상과 인과 추론을 동시에 겨냥한다. 이를 위해 우리는 머신러닝(ML) 베이스라인 세트와 다층 Difference-in-Differences(DiD) 체계를 병렬로 설계해, "동일 입력·상이한 목적"이라는 원칙 아래 하나의 파이프라인에 통합한다.

첫째, ML 베이스라인은 정형 패널(61 k × 679) 구조를 그대로 가져와 세 가지 계층으로 계열화한다. 트리-계열 앙상블(Gradient Boosting Regression Trees(GBRT), XGBoost, LightGBM)을 우선 돌려 비선형 상호작용·국부 효과를 확보한다. 하이퍼파라미터는 learning_rate∈{0.05,0.1}, max_depth∈{3,5,7}, n_estimators≤1 000 범위의 5 × 3 그리드를 TimeSeriesSplit 5-fold로 탐색한다. 트리 모델은 feature_importances_와 SHAP 값이 자동 산출돼 정책 변수(금리·GTX 착공 더미 등)의 국면별 탄력성을 시각적으로 해석할 수 있다. 고차원 선형-탄성 망(Elastic Net)(헤도닉 OLS의 연장선에서 α-혼합(0.2 ≤ α ≤ 0.8)·λ)공간을 탐색해 모델 해석력을 유지하되 변수선택을 자동화한다. 선형 베이스라인을 남겨 두면 비선형 대비 성능-복잡도 트레이드오프를 계량화할 수 있다. 또한 구간별 학습이 가능한 LSTM-FC 스택과 Temporal Fusion Transformer(TFT) 프로토타입을 구축한다. 입력은 panel_model_transformed.parquet에서 단지 식별을 one-hot이 아닌 learnable entity embedding으로 치환하고, 윈도 길이 24, 예측 호라이즌 6을 기본값으로 잡는다. GPU-기반 학습은 잦은 재학습 부담을 줄이기 위해 모델 Weights 저장 → 주간 증분(rolling retrain) 절차를 사전에 명시한다. 이러한 ML 셋업은 기존 문서에서 제안된 "GBM·LSTM 결합" 그림을 구체화한 것이다.

모델 비교는 동일 5-fold CV에서 MAPE·SMAPE·Pinball Loss(τ = 0.1, 0.5, 0.9)를 공통 지표로 계산해, 평균뿐 아니라 상-하위 분위 오차까지 동시에 평가한다. 최종 보고서 표에는 OLS-HC3, GBRT, Elastic-Net, LSTM의 네 줄을 나란히 배치해 "해석력↔성능" 스펙트럼을 시각화할 예정이다.

둘째, 다층 DiD 설계는 정책·교통 충격의 인과 효과를 정밀 추정하기 위해 패널을 도시/생활권 × 연도·분기로 다시 굵게 묶는다. 기본식은 log Pit = αi + δt + ∑ℓ=-12…+24βℓ 𝟙(τ=ℓ)it + γ Zit + εit이며, βℓ는 이벤트 ℓ 개월 전후 리드·라그 효과, Zit는 금리·LTV 상한·지역 고용률 등의 통제행렬이다. 이중 가중 DID(W-DiD)를 적용해 거래량이 적은 지역의 표본잡음을 완화하고, 표준오차는 cluster(complex_id)와 cluster(city×quarter) 두 수준에서 이중 집계해 보수적으로 평가한다. GTX 착공, 분양가 상한제 완화, 대규모 입주 물량 공시를 별도 처리기로 지정하고, 동일 시점에 중첩된 정책이 있을 때는 다중 처리(MTWFE) 프레임으로 변환한다. 군집별 이질성은 "남부-강남축 vs 북서축" 레이블을 교호항으로 두어 추정한다.

추가적으로, 정책 변수가 동태적이라는 점을 반영해 Interacted-Event Study(Sun & Abraham, 2021) 규격을 시도한다. 이는 사건 발생 시점이 지역마다 다를 때 가중 평균이 왜곡되는 문제를 해결해 주어, GTX-A 연장 구간처럼 개통 시점이 엇갈린 사례를 정확히 다룰 수 있다. 효과 크기는 분포 상-하위 10 % 단지를 따로 뽑아 Quantile-DiD도 병행해, "프리미엄 단지 vs 중저가 단지"의 정책 수혜 차이를 들여다본다.

통합 파이프라인은 panel_model_transformed → ML 스플릿과 panel_did_quarterly → DiD 회귀, 두 갈래 아웃풋을 동일 DAG 하에 기록한다. 이를 통해 사용자(정책 담당자·수요자·투자자)는 "정책이 없었다면 어떻게 됐을까?"를 DiD 그래프에서, "정책이 있더라도 최종 가격은 얼마나 될까?"를 ML 예측 밴드에서 동시에 확인할 수 있다. 이런 이중 접근은 보고서 평가 항목인 새로움, 기술적 품질, 재현 가능성을 모두 만족한다.

특징 추출 및 스케일링에서 Box-Cox·Yeo–Johnson 변환은 가격 계열뿐 아니라 왜도(|skew|>1) 변수 전반에 적용됐다. λ 값 상위 5개 예시로는 price_per_m2가 변환 전 왜도 4.10에서 변환 후 왜도 0.12로, λ (Y-J) 0.36을 보였고, loan_rate_lag3는 변환 전 왜도 2.87에서 변환 후 왜도 0.07로, λ (Y-J) 0.21을 나타냈으며, unsold_units_12m은 변환 전 왜도 3.91에서 변환 후 왜도 –0.04로, λ (Y-J) 0.18을 기록했다. script/06_transform_dist.py 내부 주요 코드에서는 from sklearn.preprocessing import PowerTransformer와 pt = PowerTransformer(method='yeo-johnson'), df[numerics] = pt.fit_transform(df[numerics])를 사용했다. Z-score 표준화와 Min-Max(0–1) 스케일을 실험한 결과, Box-Cox·Y-J가 Shapiro-Wilk p ≈ 0.19로 가장 높은 정규성 성적을 보여 최종 선택되었다.


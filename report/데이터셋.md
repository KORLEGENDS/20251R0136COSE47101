	데이터셋
패널‧변환 단계는 '설계→정규화→분포 안정화'라는 세 개의 고리로 엮였다. 먼저 03_build_panel.py는 전 레이어를 합친 원시 테이블을 complex_id × year_month 복합 키로 재구성해 월별 패널의 뼈대를 세웠다. 동일 단지‧월 중복은 0.9 %였는데, 가장 이른 항목을 남기고 제거한 뒤 총 61 138 행, 679 열이 남았다. 패널을 MultiIndex로 고정해 두면 이후 병합이나 롤링 집계에서 행정구역 변동이 있더라도 열(column)만 확장되기 때문에 "데이터 한 줄 = 특정 시점의 단지 상태"라는 해석이 유지된다. 이 시점에 단지 고정 속성(준공연도, 용적률, 학군 등)과 시간 가변 변수(거래가, 금리, 미분양 등)가 같은 레벨에 놓여 Hedonic과 Event-study를 동시에 적용할 수 있는 형태가 완성된다 .
거래가격은 원본 분포의 왜도가 4.1로 심해 로그 선형화가 선행됐다. 02_feature_engineer.py에서 ln_price = log(price_per_m2)를 만들고, 변환 전·후 히스토그램을 저장해 값이 0 이하로 내려가는 구간이 없음을 확인했다. 이어 정규성-편향 진단을 위해 04_eda_qc.py가 샘플 5 000개로 Shapiro-Wilk 검정을 반복하면서 동시에 Box-Cox λ를 계산했다. price_per_m2는 λ ≈ 0.36, 즉 로그에 가까운 형태로 수렴했고 ln_price 자체는 λ ≈ 6으로 과도한 팽창을 보여 "로그→λ≈0" 구간의 재조정 필요성이 드러났다.
실제 모델 학습용 변환은 06_transform_dist.py에서 수행했다. Box-Cox는 양수만 허용하기 때문에 0 또는 음수가 섞인 계량·거시 변수까지 포괄하려면 범위가 자유로운 Yeo–Johnson이 적합하다. 스크립트는 모든 수치 변수 중 |skew| > 1인 항목을 골라 Y-J를 적용하고, 변환 값의 상·하위 1 %를 절단(Winsorize)해 극단치를 눌렀다. 가격 계열의 경우 price_per_m2는 yj_price_per_m2로, ln_price는 yj_ln_price로 파생됐고 각 변수의 λ와 절단 구간을 메타데이터에 기록해 재현성을 확보했다. 변환 후 두 변수의 왜도는 각각 0.12와 –0.05로 크게 완화돼 Shapiro p-값(≈0.19, 0.44)이 귀무가설을 기각하지 못하는 수준으로 올라갔다. 완성된 테이블 panel_model_transformed.parquet는 원본 열을 보존한 채 "yj_"와 "_w"(Winsorized) 접미사를 추가했으며, 향후 ML 베이스라인이나 Causal-DiD 실험에서도 같은 전처리를 재사용할 수 있게 했다.
이러한 패널 구성-로그 선형화-Box-Cox/ Yeo–Johnson 체인은 (i) 단위 근 제거·정규성 확보를 통해 Hedonic OLS의 가정 위반을 최소화하고, (ii) 이벤트 스터디에서 τ-스케일 곡선의 잔차를 안정화하며, (iii) 시계열·딥러닝 모델에 바로 투입해도 학습이 가능한 범용 입력 포맷을 제공한다. 다음 절에서는 이 정제된 데이터를 바탕으로 HC3 표준오차를 갖춘 Hedonic OLS와 입주-전후 이벤트 곡선을 어떻게 결합했는지 설명한다.

#### 2-A. 전처리 파이프라인 개요
교수님 강의(Unit 3)에서 제시된 '데이터 정제·정규화' 흐름을 실무 파이프라인으로 옮긴 결과는 다음과 같다.

| 단계 | 핵심 로직 (스크립트) | 적용 함수·예시 코드 |
|------|---------------------|---------------------|
| 1. 문자 인코딩 통일 | `script/01_clean_merge.py` | `encodings = ['cp949','euc-kr','utf-8','utf-8-sig']` → 다중 시도 로드 |
| 2. 결측·이상치 처리 | `script/02_feature_engineer.py` | `df[col] = pd.to_numeric(df[col], errors='coerce')` → `fillna(method='ffill')` |
| 3. 단위·천단위 제거 | `script/01_clean_merge.py` | `price = price.str.replace(',', '')` → `astype(int)` |
| 4. Box-Cox / Yeo–Johnson 변환 | `script/06_transform_dist.py` | `yj = PowerTransformer(method='yeo-johnson')` |
| 5. Winsorize(±1 %) | 같은 `06_transform_dist.py` | `quantiles = df[col].quantile([.01,.99])` |

> 위 절차는 `output/panel_model_transformed.parquet`에 메타데이터(λ, 절단 구간)와 함께 저장되어 언제든 재현 가능한 구조를 갖춘다.